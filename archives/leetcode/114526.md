---
title: 松鼠的提示符
date: 2024-11-12
dates: 2024-11-12, 2024-11-28
---

写一个接受字符串参数列表的 **shell 脚本** `print_prompt`，按下列要求按顺序扫描参数列表，输出格式化后的字符串。

- 开始时，处于 **普通状态**。
- 遇到空字符串时，在 **普通状态** 和 **特殊状态** 间互相切换（若已处于普通状态，则切换到特殊状态；若已处于特殊状态，则切换到普通状态）。
- 遇到非空字符串时：
	- 在 **普通状态**，输出圆括号 `()` 包裹的该字符串。
	- 在 **特殊状态**，输出花括号 `{}` 包裹的该字符串。
- 完成以上处理后，在输出中加入分隔符：
	- 圆括号 `)` 和 `(` 间用竖线 `|` 分隔，花括号 `}` 和 `{` 间也用竖线 `|` 分隔。
	- 圆括号 `)` 和花括号 `{` 间用 `<` 分隔。
	- 花括号 `}` 和圆括号 `(` 间用 `>` 分隔。

你可以假设参数中不会出现这些字符：`(){}`。但是，参数中可能包含空格。

你可以选择任意 shell 语言实现。

示例1：

```
输入：["foo", "bar", "", "foo bar", "", "baz"]
输出："(foo)|(bar)<{foo bar}>(baz)"
解释：第一个和第二个参数处于普通状态。第三个参数使第四个参数变为特殊状态。第五个参数使第六个参数变为普通状态。
```

示例2：

```
输入：["foo", "bar"]
输出："(foo)|(bar)"
解释：参数中没有空字符串，因此始终处于普通状态。
```

示例3：

```
输入：["", "foo", "bar", "", "", "baz"]
输出："{foo}|{bar}|{baz}"
解释：第一个参数是空字符串，使接下来的两个参数处于特殊状态。第四个和第五个参数都是空字符串，状态切换了两次，因此最后一个参数依旧处于特殊状态。分隔符只与非空字符串所处状态有关，多余的状态切换不会产生额外的分隔符。
```

---

这是我实际正在使用的外壳提示符配置，只不过其中的括号字符实际上是终端颜色转义序列。提示符通常只有一截当前目录，但在识别到某些环境时会显示一截“特殊状态”提示符。此外，外壳子进程使用的颜色与父进程不同。

```ansi
[7;32m ~ [0;32m⧖[34m cd [4;36m/tmp[0m
[7;32m /tmp [0;32m⧖[34m poetry [36mnew demo[0m
Created package demo in demo
[7;32m 0.3ʺ │ /tmp [0;32m⧖[34m cd [4;36mdemo[0m
[7;32m /t/demo [0;32m⧖[34m git [36minit[0m
Initialized empty Git repository in /tmp/demo/.git/
[32;107m ⎇ main ▒[0;7;32m /t/demo [0;32m⧖[34m poetry [36mshell[0m
Creating virtualenv [36mdemo-hKjNfXom-py3.12[0m in /home/satgo/.cache/pypoetry/virtualenvs
Spawning shell within [34m/home/satgo/.cache/pypoetry/virtualenvs/demo-hKjNfXom-py3.12
[33;107m ⎇ main │ ⚕ demo-hKjNfXom-py3.12 ▒[0;7;33m /t/demo [0;33m⧖[34m exit[0m
[7;32m 9.9ʺ [0;32;107m▒ ⎇ main ▒[0;7;32m /t/demo [0;32m⧖[34m exit[0m
```

与Powerline不同的是，这里选用的符号不需要特别定制的字体，只需要制表符号能正常显示。
